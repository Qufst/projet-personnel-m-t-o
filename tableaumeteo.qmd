---
title: "Prévisions Météo"
format: html
editor: visual
---

## Affichage des Prévisions Météo

```{r}
library(httr)
library(jsonlite)

# L'URL de l'API
url <- "https://api.open-meteo.com/v1/meteofrance?latitude=43.6109&longitude=3.8763&daily=weathercode,temperature_2m_max,temperature_2m_min,sunrise,sunset,windspeed_10m_max&timezone=Europe%2FBerlin"

# Effectuer la requête GET
response <- GET(url)

# On vérifie si la requête a réussi (code de réponse HTTP 200)
if (http_type(response) == "application/json") {
  # On analyse les données JSON renvoyées par l'API
  data <- fromJSON(content(response,"text"))
  

  # on stocke les données :
  time <- data$daily$time
  weathercode <- data$daily$weathercode
  temperature_max <- data$daily$temperature_2m_max
  temperature_min <- data$daily$temperature_2m_min
  sunrise <- data$daily$sunrise
  sunset <- data$daily$sunset
  windspeed_max <- data$daily$windspeed_10m_max
  time[1] <- "aujourd'hui"
  time[2] <- "demain"
  # 


} else {
  cat("La requête a échoué avec le code de réponse:", http_status(response)$reason, "\n")
}
```
```{r}
# Charger la bibliothèque htmlTable
library(htmlTable)

# Créer un tableau avec les données
weather_table <- data.frame(
  Date = time,
  WeatherCode = weathercode,
  TpMax = temperature_max,
  TpMin = temperature_min,
  Sunrise = sunrise,
  Sunset = sunset,
  MaxWindSpeed = windspeed_max
)

# Convertir le tableau en un tableau HTML
weather_table_html <- htmlTable(weather_table, css.cell = "text-align:left; padding: 8px; border: 1px solid #ccc;")

print(weather_table_html)
```

```{r}
# Charger le fichier JSON local
weather_conditions <- jsonlite::fromJSON("conditions_meteo.json")

# Remplacez cette ligne par le code correspondant à votre condition météorologique actuelle
weatherCode <- 0
```
```{r}
# Afficher la description et l'image correspondantes en fonction du code météo
weatherInfo <- weather_conditions[[as.character(weatherCode)]]
if (!is.null(weatherInfo)) {
  cat(paste0("<p>", weatherInfo$description, "</p>"))
  cat(paste0("<img src='", weatherInfo$image, "' alt='Condition météorologique' />"))
} else {
  cat("Condition météorologique inconnue")
}
```
```{css}
.styled-table {
  border-collapse: collapse;
  width: 100%;
}

.styled-table th, .styled-table td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: left;
}

.styled-table th {
  background-color: #f2f2f2;
  font-weight: bold;
}

.styled-table tr:nth-child(even) {
  background-color: #f2f2f2;
}

.styled-table tr:nth-child(odd) {
  background-color: #fff;
}

.styled-table tr:hover {
  background-color: #e0e0e0;
}
```